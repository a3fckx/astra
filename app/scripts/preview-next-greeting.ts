import { getUsers } from "@/lib/mongo";

const users = getUsers();
const user = await users.findOne({ email: "attrishubhamwork@gmail.com" });

if (!user) {
	console.error("User not found");
	process.exit(1);
}

const overview = user.user_overview;
const storedMessage = overview?.first_message;
const userName = user.name || "Shubham Attri";

console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               PREVIEW: YOUR NEXT CONVERSATION GREETING                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ™ï¸  SAMAY WILL SAY:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`);

if (storedMessage && storedMessage.trim().length > 0) {
	const finalMessage = storedMessage
		.replace(/\{\{user_name\}\}/g, userName)
		.replace(/\[USERNAME\]/g, userName);
	
	console.log(`"${finalMessage}"\n`);
	console.log("âœ… Source: Personalized message from last conversation (PRIORITY 1)");
	console.log("âœ… Generated by: Transcript processor AI task");
	console.log("âœ… Stored in: MongoDB user_overview.first_message");
} else {
	const streakDays = overview?.gamification?.streak_days ?? 0;
	console.log(`(Would use streak-based fallback for streak = ${streakDays})`);
	console.log("âš ï¸  No stored first_message found - using fallback");
}

console.log(`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š CONTEXT DATA SAMAY HAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Streak: ${overview?.gamification?.streak_days ?? 0} days
Total conversations: ${overview?.gamification?.total_conversations ?? 0}
Recent conversations tracked: ${overview?.recent_conversations?.length ?? 0}
Incident map items: ${overview?.incident_map?.length ?? 0}
Topics explored: ${overview?.gamification?.topics_explored?.length ?? 0}

Birth chart: ${overview?.birth_chart ? "âœ… Complete" : "âŒ Not calculated"}
Profile summary: ${overview?.profile_summary ? "âœ… Exists" : "âŒ Empty"}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ WHY THIS MESSAGE?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

After your last conversation, the transcript processor:
1. Analyzed the full conversation transcript
2. Identified key themes: patience, "doing" philosophy, innovation
3. Referenced specific projects: moonshot, background agents
4. Highlighted your interests: intelligence, memory, learning
5. Generated this personalized opener for continuity

This makes Samay feel like a real companion who remembers YOUR journey!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`);

process.exit(0);
